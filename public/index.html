<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BloomLearn - AI Study Companion & Document Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .chat-message {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .typewriter {
            overflow: hidden;
            border-right: 3px solid rgba(255, 255, 255, 0.7);
            animation: blink 0.7s infinite;
        }
        @keyframes blink {
            50% { border-right-color: transparent; }
        }
        .pdf-preview {
            max-height: 300px;
            overflow-y: auto;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-500 min-h-screen text-white">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <header class="text-center mb-8 fade-in">
            <h1 class="text-5xl font-bold mb-2">üöÄ BloomLearn Assistant</h1>
            <p class="text-xl opacity-90 mb-2">Upload PDFs ‚Üí AI Analysis ‚Üí Smart Q&A</p>
            <div class="flex justify-center space-x-4 text-sm opacity-80">
                <span>üéì Education | ü§ñ AI-Powered | üìö Multi-Language Support</span>
            </div>
        </header>

        <!-- Main Content Grid -->
        <div class="grid lg:grid-cols-3 gap-6">
            <!-- Left Panel: Upload & Settings -->
            <div class="lg:col-span-1">
                <!-- Upload Area -->
                <div class="bg-white/10 backdrop-blur-md p-6 rounded-2xl border border-white/20 mb-6 fade-in">
                    <h2 class="text-2xl font-bold mb-4">üìÑ Upload PDF</h2>
                    
                    <div id="uploadZone" class="border-3 border-dashed border-white/40 rounded-xl p-8 text-center hover:border-white/70 transition cursor-pointer bg-white/5 hover:bg-white/10">
                        <input type="file" id="pdfUpload" accept=".pdf" class="hidden">
                        <p class="text-lg font-semibold mb-2">üì§ Click or Drag PDF</p>
                        <p class="opacity-75 text-sm">Textbooks, Notes, Articles (Max 25MB)</p>
                    </div>

                    <!-- Upload Progress -->
                    <div id="uploadProgress" class="mt-4 hidden">
                        <div class="flex justify-between mb-2">
                            <span class="text-sm font-semibold">Uploading...</span>
                            <span id="progressPercent" class="text-sm font-semibold">0%</span>
                        </div>
                        <div class="bg-white/20 rounded-full h-3 overflow-hidden">
                            <div class="bg-gradient-to-r from-green-400 to-emerald-500 h-3 rounded-full w-0 transition-all duration-300" id="progressBar"></div>
                        </div>
                    </div>

                    <!-- File Info -->
                    <div id="fileInfo" class="mt-4 p-3 bg-green-500/20 rounded-lg hidden border border-green-400/30">
                        <p class="text-sm"><strong>üìã File:</strong> <span id="fileName">document.pdf</span></p>
                        <p class="text-sm"><strong>üìä Pages:</strong> <span id="pageCount">0</span></p>
                        <p class="text-sm"><strong>‚úÖ Status:</strong> <span id="fileStatus" class="text-green-300">Processed</span></p>
                    </div>
                </div>

                <!-- Settings -->
                <div class="bg-white/10 backdrop-blur-md p-6 rounded-2xl border border-white/20 fade-in">
                    <h2 class="text-2xl font-bold mb-4">‚öôÔ∏è Settings</h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold mb-2">Student Level</label>
                            <select id="studentLevel" class="w-full p-3 bg-white/20 rounded-xl text-white border border-white/20 focus:border-green-400 focus:outline-none">
                                <option class="text-black">10th Grade</option>
                                <option class="text-black">12th Grade</option>
                                <option class="text-black">BTech Undergraduate</option>
                                <option class="text-black">Masters</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold mb-2">Language for Hints</label>
                            <select id="language" class="w-full p-3 bg-white/20 rounded-xl text-white border border-white/20 focus:border-green-400 focus:outline-none">
                                <option class="text-black">English</option>
                                <option class="text-black">Tamil</option>
                                <option class="text-black">Telugu</option>
                                <option class="text-black">Hindi</option>
                                <option class="text-black">Kannada</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-semibold mb-2">Analysis Type</label>
                            <select id="analysisType" class="w-full p-3 bg-white/20 rounded-xl text-white border border-white/20 focus:border-green-400 focus:outline-none">
                                <option class="text-black">Summary</option>
                                <option class="text-black">Key Points</option>
                                <option class="text-black">Bloom's Taxonomy</option>
                                <option class="text-black">Study Guide</option>
                                <option class="text-black">Quiz Questions</option>
                            </select>
                        </div>

                        <button id="analyzeBtn" class="w-full bg-gradient-to-r from-green-400 to-emerald-500 hover:from-green-500 hover:to-emerald-600 p-3 rounded-xl font-bold text-lg text-black transition transform hover:scale-105 duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                            üîç Analyze Document
                        </button>
                    </div>
                </div>

                <!-- PDF Preview -->
                <div id="pdfPreviewSection" class="bg-white/10 backdrop-blur-md p-6 rounded-2xl border border-white/20 mt-6 hidden">
                    <h3 class="text-xl font-bold mb-4">üëÅÔ∏è PDF Preview</h3>
                    <div id="pdfPreview" class="pdf-preview bg-white/5 rounded-lg p-4 text-sm leading-relaxed"></div>
                </div>
            </div>

            <!-- Right Panel: Results & Chat -->
            <div class="lg:col-span-2">
                <!-- Tabs for Results -->
                <div class="bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 overflow-hidden fade-in">
                    <div class="flex border-b border-white/20">
                        <button class="tab-btn flex-1 p-4 font-bold text-center border-b-2 border-green-400 bg-gradient-to-r from-green-500/20 to-green-600/10" data-tab="analysis">
                            üìä Analysis
                        </button>
                        <button class="tab-btn flex-1 p-4 font-bold text-center border-b-2 border-transparent hover:border-white/30" data-tab="chat">
                            üí¨ AI Assistant
                        </button>
                        <button class="tab-btn flex-1 p-4 font-bold text-center border-b-2 border-transparent hover:border-white/30" data-tab="bloom">
                            üß† Bloom's Map
                        </button>
                    </div>

                    <!-- Tab Content -->
                    <div class="p-6 min-h-96">
                        <!-- Analysis Tab -->
                        <div id="analysis-tab" class="tab-content">
                            <div id="analysisOutput" class="space-y-4">
                                <div class="text-center py-8 opacity-75">
                                    <p class="text-lg">üì§ Upload a PDF to see analysis results here</p>
                                </div>
                            </div>
                        </div>

                        <!-- Chat Tab -->
                        <div id="chat-tab" class="tab-content hidden">
                            <div class="flex flex-col h-96">
                                <!-- Chat Messages -->
                                <div id="chatMessages" class="flex-1 overflow-y-auto space-y-4 mb-4 pr-2">
                                    <div class="chat-message p-4 bg-white/10 rounded-lg">
                                        <p class="text-sm"><strong>ü§ñ Assistant:</strong> Hello! I'm your AI study companion. Upload a PDF and ask me anything about it‚Äîsummarize, explain concepts, create practice questions, or translate to your preferred language.</p>
                                    </div>
                                </div>

                                <!-- Chat Input -->
                                <div class="flex gap-2">
                                    <input type="text" id="chatInput" placeholder="Ask me about the document..." class="flex-1 p-3 bg-white/20 rounded-xl text-white border border-white/20 focus:border-green-400 focus:outline-none placeholder-white/50">
                                    <button id="sendBtn" class="bg-gradient-to-r from-blue-400 to-blue-600 hover:from-blue-500 hover:to-blue-700 p-3 rounded-xl font-bold transition transform hover:scale-105 duration-300">
                                        ‚úàÔ∏è
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Bloom's Tab -->
                        <div id="bloom-tab" class="tab-content hidden">
                            <div id="bloomOutput" class="space-y-4">
                                <div class="text-center py-8 opacity-75">
                                    <p class="text-lg">üì§ Upload a PDF to generate Bloom's Taxonomy mapping</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Loading Spinner -->
                <div id="loadingSpinner" class="hidden mt-6 flex justify-center">
                    <div class="flex space-x-2">
                        <div class="w-3 h-3 bg-green-400 rounded-full animate-bounce" style="animation-delay: 0s;"></div>
                        <div class="w-3 h-3 bg-blue-400 rounded-full animate-bounce" style="animation-delay: 0.2s;"></div>
                        <div class="w-3 h-3 bg-purple-400 rounded-full animate-bounce" style="animation-delay: 0.4s;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center mt-12 opacity-70 text-sm">
            <p>üöÄ BloomLearn Assistant | Built with ‚ù§Ô∏è | Gemini AI Powered</p>
            <p class="text-xs mt-1 opacity-60">Supports PDF analysis, Bloom's Taxonomy mapping, and multi-language support</p>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfjs-dist/3.11.174/pdf.worker.min.js"></script>
    <script>
        // ============== Configuration ==============
        const CONFIG = {
            API_BASE: '/api',
            GEMINI_API_KEY: localStorage.getItem('GEMINI_API_KEY') || 'YOUR_GEMINI_API_KEY',
            MAX_FILE_SIZE: 25 * 1024 * 1024, // 25MB
            PDF_MAX_PAGES: 50
        };

        // ============== State Management ==============
        const state = {
            currentPDF: null,
            extractedText: '',
            pageCount: 0,
            uploadedFileName: ''
        };

        // ============== PDF Upload Handlers ==============
        const uploadZone = document.getElementById('uploadZone');
        const pdfUpload = document.getElementById('pdfUpload');
        const analyzeBtn = document.getElementById('analyzeBtn');

        // Click to upload
        uploadZone.addEventListener('click', () => pdfUpload.click());

        // Drag & Drop
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('bg-white/20', 'border-white/70');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('bg-white/20', 'border-white/70');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('bg-white/20', 'border-white/70');
            const file = e.dataTransfer.files[0];
            if (file?.type === 'application/pdf') {
                handlePDFUpload(file);
            } else {
                showAlert('‚ùå Please upload a PDF file', 'error');
            }
        });

        // File input change
        pdfUpload.addEventListener('change', (e) => {
            if (e.target.files[0]) {
                handlePDFUpload(e.target.files[0]);
            }
        });

        async function handlePDFUpload(file) {
            // Validation
            if (file.size > CONFIG.MAX_FILE_SIZE) {
                showAlert('‚ùå File too large! Maximum 25MB allowed', 'error');
                return;
            }

            state.uploadedFileName = file.name;
            showLoadingProgress();

            try {
                // Extract PDF text
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                state.pageCount = pdf.numPages;

                let fullText = '';
                const pageLimit = Math.min(state.pageCount, CONFIG.PDF_MAX_PAGES);

                for (let i = 1; i <= pageLimit; i++) {
                    const page = await pdf.getPage(i);
                    const textContent = await page.getTextContent();
                    fullText += textContent.items.map(item => item.str).join(' ') + '\n';

                    // Update progress
                    updateProgress(Math.round((i / pageLimit) * 100));
                }

                state.extractedText = fullText;
                state.currentPDF = file;

                // Show file info
                showFileInfo();

                // Display PDF preview
                displayPDFPreview(fullText);

                hideLoadingProgress();
                showAlert('‚úÖ PDF uploaded successfully!', 'success');
                analyzeBtn.disabled = false;

            } catch (error) {
                console.error('PDF Processing Error:', error);
                showAlert('‚ùå Error processing PDF: ' + error.message, 'error');
                hideLoadingProgress();
            }
        }

        function showFileInfo() {
            const fileInfoDiv = document.getElementById('fileInfo');
            document.getElementById('fileName').textContent = state.uploadedFileName;
            document.getElementById('pageCount').textContent = state.pageCount;
            fileInfoDiv.classList.remove('hidden');
        }

        function displayPDFPreview(text) {
            const preview = document.getElementById('pdfPreview');
            const previewSection = document.getElementById('pdfPreviewSection');
            preview.textContent = text.substring(0, 1000) + (text.length > 1000 ? '...' : '');
            previewSection.classList.remove('hidden');
        }

        function showLoadingProgress() {
            document.getElementById('uploadProgress').classList.remove('hidden');
        }

        function hideLoadingProgress() {
            document.getElementById('uploadProgress').classList.add('hidden');
        }

        function updateProgress(percent) {
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('progressPercent').textContent = percent + '%';
        }

        // ============== Analysis Handlers ==============
        analyzeBtn.addEventListener('click', async () => {
            if (!state.extractedText) {
                showAlert('‚ùå Please upload a PDF first', 'error');
                return;
            }

            const analysisType = document.getElementById('analysisType').value;
            const studentLevel = document.getElementById('studentLevel').value;
            const language = document.getElementById('language').value;

            analyzeBtn.disabled = true;
            showLoading(true);

            try {
                const result = await analyzeDocument(
                    state.extractedText,
                    analysisType,
                    studentLevel,
                    language
                );

                displayAnalysisResult(result, analysisType);
                switchTab('analysis');
                showAlert('‚úÖ Analysis complete!', 'success');

            } catch (error) {
                console.error('Analysis Error:', error);
                showAlert('‚ùå Analysis failed: ' + error.message, 'error');
            } finally {
                analyzeBtn.disabled = false;
                showLoading(false);
            }
        });

        async function analyzeDocument(text, analysisType, level, language) {
            // Simulated API call - Replace with actual backend
            return new Promise((resolve) => {
                setTimeout(() => {
                    const analysis = generateMockAnalysis(text, analysisType, level, language);
                    resolve(analysis);
                }, 1500);
            });
        }

        function generateMockAnalysis(text, type, level, language) {
            const summary = `This document covers fundamental concepts in ${extractMainTopics(text)}. 
            It appears to be designed for ${level} students and contains approximately ${Math.round(text.length / 100)} key sections.`;

            const keyPoints = extractKeyPoints(text);
            const questions = generateQuestions(text, level);
            const bloomMap = generateBloomsMap(text);

            return { summary, keyPoints, questions, bloomMap };
        }

        function extractMainTopics(text) {
            const topics = ['mathematics', 'science', 'history', 'literature', 'technology'];
            return topics[Math.floor(Math.random() * topics.length)];
        }

        function extractKeyPoints(text) {
            return [
                'üîë ' + text.substring(100, 150).trim(),
                'üîë ' + text.substring(300, 350).trim(),
                'üîë ' + text.substring(500, 550).trim()
            ];
        }

        function generateQuestions(text, level) {
            return [
                { q: 'What is the main topic discussed in this document?', type: 'Remember' },
                { q: 'How would you apply these concepts in real life?', type: 'Apply' },
                { q: 'Can you compare and contrast the key ideas?', type: 'Analyze' },
                { q: 'Create a new example based on these principles.', type: 'Create' }
            ];
        }

        function generateBloomsMap(text) {
            return {
                remember: ['Identify key terms', 'List main points'],
                understand: ['Explain concepts', 'Describe relationships'],
                apply: ['Solve problems using concepts', 'Use examples'],
                analyze: ['Break down ideas', 'Compare components'],
                evaluate: ['Judge effectiveness', 'Support conclusions'],
                create: ['Develop solutions', 'Design new approaches']
            };
        }

        function displayAnalysisResult(result, type) {
            const output = document.getElementById('analysisOutput');
            
            let html = '';
            if (type === 'Summary') {
                html = `
                    <div class="bg-gradient-to-r from-yellow-400/20 to-orange-400/20 p-6 rounded-xl border border-yellow-400/30">
                        <h3 class="text-xl font-bold mb-3">üìã Document Summary</h3>
                        <p class="leading-relaxed">${result.summary}</p>
                    </div>
                `;
            } else if (type === 'Key Points') {
                html = `
                    <div class="bg-gradient-to-r from-blue-400/20 to-cyan-400/20 p-6 rounded-xl border border-blue-400/30">
                        <h3 class="text-xl font-bold mb-4">üéØ Key Points Extracted</h3>
                        <ul class="space-y-2">
                            ${result.keyPoints.map(pt => `<li class="flex items-start"><span class="mr-2">‚úì</span><span>${pt}</span></li>`).join('')}
                        </ul>
                    </div>
                `;
            } else if (type === 'Quiz Questions') {
                html = `
                    <div class="space-y-4">
                        <h3 class="text-xl font-bold">‚ùì Generated Questions</h3>
                        ${result.questions.map((q, i) => `
                            <div class="bg-gradient-to-r from-purple-400/20 to-pink-400/20 p-4 rounded-xl border border-purple-400/30">
                                <p class="font-bold mb-2">Q${i+1}: ${q.q}</p>
                                <p class="text-sm opacity-75">Bloom's Level: <span class="font-semibold">${q.type}</span></p>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else if (type === 'Bloom\'s Taxonomy') {
                html = `
                    <div class="space-y-3">
                        <h3 class="text-xl font-bold mb-4">üß† Bloom's Taxonomy Mapping</h3>
                        ${Object.entries(result.bloomMap).map(([level, items]) => `
                            <div class="bg-white/10 p-4 rounded-lg border border-white/20">
                                <p class="font-bold capitalize mb-2 text-green-300">${level}</p>
                                <ul class="text-sm space-y-1 opacity-90">
                                    ${items.map(item => `<li>‚Ä¢ ${item}</li>`).join('')}
                                </ul>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            output.innerHTML = html;
        }

        // ============== Chat Handlers ==============
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        const chatMessages = document.getElementById('chatMessages');

        sendBtn.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message || !state.extractedText) {
                showAlert('‚ùå Please upload a PDF first', 'error');
                return;
            }

            // Add user message
            addChatMessage(message, 'user');
            chatInput.value = '';

            try {
                const response = await generateChatResponse(message, state.extractedText);
                addChatMessage(response, 'assistant');
            } catch (error) {
                addChatMessage('‚ùå Error: ' + error.message, 'assistant');
            }
        }

        async function generateChatResponse(userMessage, documentText) {
            // Simulated response - Replace with actual Gemini API
            return new Promise((resolve) => {
                setTimeout(() => {
                    const responses = [
                        `Based on the document: ${userMessage.includes('summary') ? 'The document provides a comprehensive overview of key concepts.' : 'That\'s an excellent question. Let me explain based on the document content...'}`,
                        `Great question! The document discusses this in detail. ${documentText.substring(100, 200).trim()}...`,
                        `According to the material, ${userMessage.toLowerCase().includes('why') ? 'this occurs because of the fundamental principles outlined in earlier sections.' : 'this is one of the main points covered.'}`,
                        `The document clearly states that... [relevant excerpt]`
                    ];
                    resolve(responses[Math.floor(Math.random() * responses.length)]);
                }, 800);
            });
        }

        function addChatMessage(message, role) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message p-4 rounded-lg ${role === 'user' ? 'bg-blue-500/20 ml-8 text-right' : 'bg-white/10 mr-8'}`;
            messageDiv.innerHTML = `<p class="text-sm"><strong>${role === 'user' ? 'üë§ You:' : 'ü§ñ Assistant:'}</strong> ${message}</p>`;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // ============== Tab Navigation ==============
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => switchTab(btn.dataset.tab));
        });

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('bg-gradient-to-r', 'from-green-500/20', 'to-green-600/10', 'border-green-400'));
            
            document.getElementById(`${tabName}-tab`).classList.remove('hidden');
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('bg-gradient-to-r', 'from-green-500/20', 'to-green-600/10', 'border-green-400');
        }

        // ============== Utility Functions ==============
        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `fixed top-4 right-4 p-4 rounded-lg font-semibold ${
                type === 'success' ? 'bg-green-500/80' : type === 'error' ? 'bg-red-500/80' : 'bg-blue-500/80'
            } fade-in z-50`;
            alertDiv.textContent = message;
            document.body.appendChild(alertDiv);

            setTimeout(() => {
                alertDiv.remove();
            }, 3000);
        }

        function showLoading(show) {
            const spinner = document.getElementById('loadingSpinner');
            if (show) {
                spinner.classList.remove('hidden');
            } else {
                spinner.classList.add('hidden');
            }
        }

        // Initialize
        analyzeBtn.disabled = true;
        console.log('üöÄ BloomLearn Assistant Loaded');
    </script>
</body>
</html>